

$(document).ready((function(){function t(t=$("#selectpj2sum").val()){$(".kpi").html("0"),$(".pjduration").html("0 Days (0 h)"),$(".tasksduration").html("0 h");var e=$.ajax({type:"POST",url:"./API/dash.php",data:{kpiData:t},dataType:"text",context:document.body,global:!1,async:!1,success:function(t){return t}}).responseText;$res=JSON.parse(e),$(".kpi").html($res.ProjectKPI),$(".pjduration").html(`${$res.ProjectTotalDays} Days ( ${$res.ProjectTotalHours} h )`),$(".tasksduration").html(`${$res.ProjectRealDuration} h`)}function e(){$("#donut").html("");var t=$.ajax({type:"POST",url:"./API/dash.php",data:{sum:"1"},dataType:"text",context:document.body,global:!1,async:!1,success:function(t){return t}}).responseText;sumt=JSON.parse(t),$(".totalpjs").html(sumt.tot),$(".donepjs").html(sumt.don),$(".ontrackpjs").html(sumt.ont),$(".notspjs").html(sumt.not);var e={labels:["Done","On Track","Not Started"],series:[parseInt(sumt.don),parseInt(sumt.ont),parseInt(sumt.not)],colors:["#6eb857","#ebd747","#6d2479"],fill:{colors:["#6eb857","#ebd747","#6d2479"]},dataLabels:{style:{fontSize:"10px",fontWeight:"bold"}},chart:{type:"donut"},responsive:[{breakpoint:480,options:{chart:{width:250},legend:{position:"bottom"}}}]};new ApexCharts(document.querySelector("#donut"),e).render()}function a(){var t=$.ajax({type:"POST",url:"./API/dash.php",data:{projectlist:"1"},dataType:"text",context:document.body,global:!1,async:!1,success:function(t){return t}}).responseText;sel="",$.each(JSON.parse(t),(function(t,e){sel+=`<option value="${e.id}">${e.title}</option>`})),$("#selectpj2sum").html(sel)}function s(t=$("#selectpj2sum").val()){$("#perff").html("");var e=$.ajax({type:"POST",url:"./API/dash.php",data:{velocity:t},dataType:"json",context:document.body,global:!1,async:!1,success:function(t){return t}}).responseText;categ=[],categc=0,datas=[],$.each(JSON.parse(e),(function(t,e){categc++,categ.push(categc),datas.push(e.stories)}));var a={series:[{name:"",data:datas}],chart:{type:"bar",height:240},plotOptions:{bar:{horizontal:!1,columnWidth:"40%",endingShape:"rounded"}},dataLabels:{enabled:!1},stroke:{show:!0,width:2,colors:["transparent"]},xaxis:{categories:categ},yaxis:{title:{text:`Project ${t} Story Points`}},fill:{opacity:1},tooltip:{y:{formatter:function(t){return t+"Total Stories"}}}};new ApexCharts(document.querySelector("#perff"),a).render()}function o(t=$("#selectpj2sum").val()){$("#MembersPerfchart").html("");var e=$.ajax({type:"POST",url:"./API/dash.php",data:{membersstat:t},dataType:"json",context:document.body,global:!1,async:!1,success:function(t){return t}}).responseText;pjd=[],names=[],onp=[],ofp=[],av=[],$.each(JSON.parse(e).members,(function(t,a){pjd.push(parseInt(JSON.parse(e).project_dur)),names.push(a.fullname),onp.push(a.tasks.on),ofp.push(a.tasks.off),av.push(a.tasks.av)}));var a={series:[{type:"column",name:"Project Duration",data:pjd},{name:"ON Project",type:"column",data:onp},{name:"OFF Project",type:"column",data:ofp},{name:"Available",type:"column",data:av}],chart:{type:"bar",height:300,stacked:!1,stackType:"100%"},plotOptions:{bar:{horizontal:!1}},stroke:{width:1,colors:["#fff"]},title:{text:""},xaxis:{categories:names},tooltip:{y:{formatter:function(t){return t+"h"}}},fill:{opacity:1},legend:{position:"top",horizontalAlign:"center",offsetX:40}};new ApexCharts(document.querySelector("#MembersPerfchart"),a).render()}$("#selectpj2sum").change((function(){s($(this).val()),o($(this).val()),t($(this).val())})),$("#selectpj2sum").blur((function(){s($(this).val()),o($(this).val()),t($(this).val())})),$("#btndash").click((function(){s(),e(),a()})),$("#btndash").click((function(n){a(),e(),s(),o(),t()})),a(),e(),s(),o(),t()}));
