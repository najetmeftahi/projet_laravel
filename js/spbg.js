

const stat={1:"Not Started",2:"On Track",3:"Done"},prio={1:"Low",2:"Normal",3:"High"};function updateEst(t,s,e){$.ajax({type:"GET",url:"./API/edit_storyduration.php?pid="+t+"&sid="+s+"&stid="+e,dataType:"text",success:function(t){}})}function LoadSprintMembers(t,s){members_r={};var e=$.ajax({type:"GET",url:"./API/list_spmembers.php?pid="+t+"&sid="+s,context:document.body,global:!1,async:!1,success:function(t){return t}}).responseText;return $.each(JSON.parse(e),(function(t,s){members_r[s.id]=`${s.firstname} ${s.lastname}`})),members_r}function loadStories(t,s){var e=$.ajax({type:"GET",url:"./API/list_stories.php?pid="+t+"&sid="+s,dataType:"text",context:document.body,global:!1,async:!1,success:function(t){return t}}).responseText;return JSON.parse(e)}function ListMembers(t){return tds="",$.each(t,(function(t,s){tds+=`<td id="newsmemcol" memid="${t}">${s}</td>`})),MembersCount=Object.keys(t).length,$("#memberscolhead").attr("colspan",MembersCount),$("#addstcc").attr("colspan",10+parseInt(MembersCount)),tds}function ListRespMembers(t,s){return ops="",obj=LoadSprintMembers(t,s),$.each(obj,(function(t,s){ops=`<option value="${t}">${s}</option>`+ops})),ops}function LoadTaskEst(t,s,e,i){estCells="";var a=$.ajax({type:"GET",url:"./API/list_estimations.php?pid="+t+"&sid="+s+"&stid="+e+"&tid="+i,dataType:"text",context:document.body,global:!1,async:!1,success:function(t){return t}}).responseText;return $.each(JSON.parse(a),(function(a,n){estCells=`<td class="tskEstdata" tid="${i}" stid="${e}" spid="${s}" pid="${t}" jid="${n.judge_id}">${n.est_val}</td>`+estCells})),updateEst(t,s,e),estCells}function LoadStoryTasks(t,s,e){taskrows="";var i=$.ajax({type:"GET",url:"./API/list_tasks.php?pid="+t+"&sid="+s+"&stid="+e,dataType:"text",context:document.body,global:!1,async:!1,success:function(t){return t}}).responseText;return $.each(JSON.parse(i),(function(i,a){MemberEstimations=LoadTaskEst(t,s,e,a.id),taskrows+=`\n        <tr class="taskrow" tid="${a.id}" stid="${a.story_id}" spid="${a.sprint_id}" pid="${a.project_id}">\n            <td class="text-muted">${i+1}</td>\n            <td class="tskwdata" for="title">${a.title}</td>\n            <td class="tskwdata" for="goal">${a.goal}</td>\n            <td class="tsksdata" for="priority" valcode="${a.priority}">${prio[a.priority]}</td>\n            <td class="tsksdata text-muted fw-bold" for="tskstatus" valcode="${a.tskstatus}">${stat[a.tskstatus]}</td>\n            <td class="tsksdata" for="assignee_id" memid="${a.assignee_id}">${a.firstname} ${a.lastname}</td>\n            <td class="relest tskwdata" for="real_dur" tid="${a.id}" stid="${a.story_id}" spid="${a.sprint_id}" pid="${a.project_id}">${a.real_dur}</td>\n            <td class="estdur" for="est_dur" stid="${a.story_id}" spid="${a.sprint_id}" pid="${a.project_id}">${a.est_dur}</td>\n            ${MemberEstimations}\n            <td id="taskEditCell" tid="${a.id}" stid="${a.story_id}" spid="${a.sprint_id}" pid="${a.project_id}">\n            <span class="btn btn-sm text-muted" id="CallToEditTask"><i class="fa-solid fa-square-pen"></i></span>\n            <span class="btn btn-sm text-success d-none" id="SaveEditedTask"><i class="fa-solid fa-check-double"></i></span>\n            <span class="btn btn-sm text-warning d-none" id="CancelEditTask"><i class="fa-solid fa-circle-xmark"></i></span>\n            <span class="btn btn-sm text-danger d-none" id="DeleteTask"><i class="fa-solid fa-trash"></i></span>\n            </td>\n        </tr>\n        `})),taskrows}function ListStories(t=$("#spbgtable").attr("pid"),s=$("#spbgtable").attr("sid")){globalThis.colcount=Object.keys(LoadSprintMembers(t,s)).length,$("#Sprintstory").html(""),LoadedStories=loadStories(t,s),ListedMembers=ListMembers(LoadSprintMembers(t,s)),StoryRow="",$.each(LoadedStories,(function(t,s){ThisStoryTasks=LoadStoryTasks(s.project_id,s.sprint_id,s.id),StoryRow=`\n            <tr id="SpStoryHeader" class="text-muted fw-bold table-secondary table-lg" stid="${s.id}" spid="${s.sprint_id}" pid="${s.project_id}">\n                <td><i class="fa-solid fa-circle"></i></td>\n                <td class="stwdata" for="title" contenteditable="false">${s.title}</td>\n                <td class="stwdata" for="goal" contenteditable="false">${s.goal}</td>\n                <td class="stsdata" for="priority" valcode="${s.priority}">${prio[s.priority]}</td>\n                <td class="stsdata text-muted fw-bold" for="ststatus" valcode="${s.ststatus}">${stat[s.ststatus]}</td>\n                <td class="fw-lighter">Task Assignee</td>\n                <td class="fw-bold"><span class="badge bg-info iws-bg-blue">${s.real_dur} h</span></td>\n                <td class="fw-bold"><span class="badge bg-secondary">${s.est_dur} h</span></td>\n                ${ListedMembers}\n                <td>\n                    <span class="btn btn-sm btn-outline-danger border-0" id="CallToDeleteStory">\n                        <i class="fa-solid fa-trash"></i>\n                    </span>\n                </td>\n            </tr>\n            ${ThisStoryTasks}\n                `,$(StoryRow).appendTo("#Sprintstory"),AddTaskCntrl=`\n            <tr class="newtaskbtnrow text-center text-muted">\n                    <td colspan="14">\n                        <button class="newtaskbtn btn btn-sm btn-outline-secondary border-0 fw-light" id="AddTaskToStory"  stid="${s.id}" spid="${s.sprint_id}" pid="${s.project_id}" colcount="">\n                            + Add New Task\n                        </button>\n                    </td>\n            </tr>\n                `,$(AddTaskCntrl).appendTo("#Sprintstory")}))}function addNewTask(t,s,e,i,a,n,d,o){$.ajax({type:"GET",url:"./API/store_task.php?pid="+t+"&sid="+s+"&stid="+e+"&title="+i+"&goal="+a+"&pr="+n+"&resp="+o+"&status="+d,data:"data",dataType:"text",success:function(t){}})}function editEst(t,s,e,i,a,n){$.ajax({type:"GET",url:"./API/edit_estimation.php?pid="+t+"&sid="+s+"&stid="+e+"&tid="+i+"&jid="+a+"&newval="+n,dataType:"text",success:function(t){}})}function deleteTask(t,s,e,i){$.ajax({type:"GET",url:"./API/delete_task.php?pid="+t+"&sid="+s+"&stid="+e+"&tid="+i,dataType:"text",success:function(t){}})}function addNewStory(t,s,e,i,a,n){$.ajax({type:"GET",url:"./API/store_story.php?pid="+t+"&sid="+s+"&title="+e+"&goal="+i+"&pr="+a+"&status="+n,data:"data",dataType:"json",success:function(t){}}),ListStories()}function editTask(t,s,e,i,a,n){$.ajax({type:"GET",url:"./API/edit_task.php?pid="+t+"&sid="+s+"&stid="+e+"&tid="+i+"&for="+a+"&newval="+n,data:"data",dataType:"text",success:function(t){}})}function editStory(t,s,e,i,a){$.ajax({type:"GET",url:"./API/edit_story.php?pid="+t+"&sid="+s+"&stid="+e+"&for="+i+"&newval="+a,dataType:"text",success:function(t){}})}function DeleteStory(t,s,e){$.ajax({type:"GET",url:"./API/delete_story.php?pid="+t+"&sid="+s+"&stid="+e,dataType:"text",success:function(t){}})}function DeleteSprint(t,s){$.ajax({type:"GET",url:"./API/delete_sprint.php?pid="+t+"&sid="+s,dataType:"text",success:function(t){}})}function loadOffTasks(t=$(".offpjtable").attr("pid"),s=$(".offpjtable").attr("sid")){var e=$.ajax({type:"POST",url:"./API/tasks_off.php",data:{action:"loadofftasks",pid:t,sid:s},dataType:"json",context:document.body,global:!1,async:!1,success:function(t){return t}}).responseText;$useroffrow="",$.each(JSON.parse(e),(function(e,i){userid=e,$useroffrow+=`\n            <tr class="offt-userheader table-secondary" pid="${t}" sid="${s}" user-id="${e}">\n                <td class="text-muted fw-bold">${i.fullname}</td>\n                <td></td>\n                <td></td>\n                <td><span class="badge bg-secondary">${i.done_duration} h</span></td>\n                <td><button class="addofftask btn btn-sm btn-outline-secondary border-0 fw-light"><i class="fa-solid fa-square-plus"></i></button></td>\n            </tr>\n            `,offtaskrow="",$.each(i.tasks,(function(e,i){offtaskrow+=`\n                <tr class="offt-usertask" pid="${t}" sid="${s}" user-id="${userid}" task-id="${i.taskid}">\n                    <td></td>\n                    <td class="text-start offtask-data" for="title" contenteditable="false">${i.title}</td>\n                    <td class="text-muted offtask-toggle-data" init="${i.status}" for="tskstatus">${stat[i.status]}</td>\n                    <td class="offtask-data" for="duration" contenteditable="false">${i.duration}</td>\n                    <td><button class="Deleteofftask btn btn-sm text-danger"><i class="fa-solid fa-trash"></i></button></td>\n                </tr>\n                `})),$useroffrow+=offtaskrow})),$(".offpjtablebody").html(""),$(".offpjtablebody").html($useroffrow)}function offtaskUpdate(t,s,e,i,a,n){$.ajax({type:"POST",url:"./API/tasks_off.php",data:{action:"updateofftask",pid:t,sid:s,tid:e,uid:i,for:a,newval:n},dataType:"json",context:document.body,global:!1,async:!1,success:function(t){return t}}).responseText;loadOffTasks()}$("#sprintbacklogtablearea").on("click","#AddTaskToStory",(function(){$(".newtaskbtn").attr("disabled",!0),nt_pid=$(this).attr("pid"),nt_spid=$(this).attr("spid"),nt_stid=$(this).attr("stid"),$(this).attr("colcount",parseInt($("#SpStoryHeader").children().length)-7);var t=$(this).attr("colcount");memberopslist=ListRespMembers(nt_pid,nt_spid),NewOrderTask=$(this).parent().parent().prevUntil("#SpStoryHeader").length+1,NewBlankTask=`\n            <tr id="NewBlankTaskRow" pid="${nt_pid}" spid="${nt_spid}" stid="${nt_stid}">\n            <td class="text-muted">${NewOrderTask}</td>\n            <td contenteditable="plaintext-only" id="ntt">New task title</td>\n            <td contenteditable="plaintext-only" id="ntg">New task Goal</td>\n            <td>\n                <select id="ntp" class="form-select form-select-sm">\n                <option value="1" selected>Low</option>\n                <option value="2">Normal</option>\n                <option value="3">High</option>\n                </select>\n            </td>\n            <td class="text-muted fw-bold">\n                <select id="nts" class="form-select form-select-sm">\n                <option value="1" selected>Not Started</option>\n                <option value="2">On Track</option>\n                <option value="3">Done</option>\n                </select>\n            </td>\n            <td>\n                <select id="ntr" class="form-select form-select-sm">\n                ${memberopslist}\n                </select>\n            </td>\n            <td id="nt-est" mid="mem1" colspan = "${t}"></td>\n\n            <td>\n                <span class="btn btn-sm btn-outline-warning" id="CancelAddNewTask"><i class="fa-solid fa-circle-xmark"></i></span>\n                <span class="btn btn-sm btn-outline-success btn-iws-outline-green" id="ConfirmAddNewTask"><i class="fa-solid fa-check-double"></i></span>\n            </td>\n            </tr>`,$(NewBlankTask).insertBefore($(this).parent().parent())})),$("#sprintbacklogtablearea").on("click","#CancelAddNewTask",(function(){$(".newtaskbtn").attr("disabled",!1),$(this).parent().parent().remove()})),$("#sprintbacklogtablearea").on("click","#ConfirmAddNewTask",(function(){pid=$(this).parent().parent().attr("pid"),spid=$(this).parent().parent().attr("spid"),stid=$(this).parent().parent().attr("stid"),t=$("#ntt").text(),g=$("#ntg").text(),p=$("#ntp").val(),s=$("#nts").val(),resp=$("#ntr").val(),addNewTask(pid,spid,stid,t,g,p,s,resp),ListStories(),$(this).parent().parent().remove()})),$("#sprintbacklogtablearea").on("click",".tskEstdata",(function(){$(this).addClass("noborder"),$(this).attr("contenteditable","plaintext-only"),$(this).focus()})),$("#sprintbacklogtablearea").on("blur",".tskEstdata",(function(){tid=$(this).attr("tid"),stid=$(this).attr("stid"),spid=$(this).attr("spid"),pid=$(this).attr("pid"),jid=$(this).attr("jid"),newval=parseInt($(this).text()),editEst(pid,spid,stid,tid,jid,newval),$(this).attr("contenteditable","false"),setTimeout((()=>{ListStories()}),50)})),$("#sprintbacklogtablearea").on("click","#CallToEditTask",(function(){tid=$(this).parent().attr("tid"),stid=$(this).parent().attr("stid"),spid=$(this).parent().attr("spid"),pid=$(this).parent().attr("pid"),$(this).addClass("d-none"),$(this).next().removeClass("d-none"),$(this).nextAll().eq(1).removeClass("d-none"),$(this).nextAll().eq(2).removeClass("d-none")})),$("#sprintbacklogtablearea").on("click","#SaveEditedTask",(function(){})),$("#sprintbacklogtablearea").on("click","#CancelEditTask",(function(){$(this).addClass("d-none"),$(this).next().addClass("d-none"),$(this).prev().addClass("d-none"),$(this).prevAll().eq(1).removeClass("d-none")})),$("#sprintbacklogtablearea").on("click","#DeleteTask",(function(){tid=$(this).parent().attr("tid"),stid=$(this).parent().attr("stid"),spid=$(this).parent().attr("spid"),prid=$(this).parent().attr("pid"),deleteTask(prid,spid,stid,tid),setTimeout((()=>{updateEst(prid,spid,stid),ListStories()}),50)})),AControls='\n<button class="btn btn-md btn-outline-secondary fw-bold border-0" id="CallAddNewStory">\n<i class="fa-solid fa-circle"></i> New Story\n</button>\n',CCControls='\n<button class="btn btn-sm btn-iws-outline-red fw-bold border-0" id="CancelNewStory"><i class="fa-solid fa-xmark"></i> Cancel</button>\n<button class="btn btn-sm btn-outline-success btn-iws-outline-green fw-bold border-0" id="ConfirmNewStory"><i class="fa-solid fa-check-double"></i> Confirm</button>\n',$("#sprintbacklogtablearea").on("click","#CallAddNewStory",(function(){addnewstorybtn=$(this).parent().parent().parent(),$(this).parent().parent().parent().remove(),$(this).parent().html(CCControls),$(".newtaskbtnrow").hide(),ThisSprintMembers=LoadSprintMembers($("#spbgtable").attr("pid"),$("#spbgtable").attr("sid")),NMC="",$.each(ThisSprintMembers,(function(t,s){NMC+=`<td id="newsmemcol" memid="${t}">${s}</td>`})),MembersCount=Object.keys(ThisSprintMembers).length,$("#memberscolhead").attr("colspan",MembersCount),$(this).parent().attr("colspan",10+parseInt(MembersCount)),NewBlankStory=`\n    <tr id="nsheader" class="table-secondary text-muted">\n        <input type="hidden" id="StoryxTasksCount" value="0">\n        <td scope="col-3"><i class="fa-solid fa-circle"></i></td>\n        <td scope="col" id="nst" contenteditable="plaintext-only">New Story title</td>\n        <td scope="col" id="nsg" contenteditable="plaintext-only">New Story Goal</td>\n        <td scope="col">\n        <select id="nsp" class="form-select form-select-sm">\n        <option value="1" selected>Low</option>\n        <option value="2">Normal</option>\n        <option value="3">High</option>\n        </select>\n        </td>\n        <td class="text-muted fw-bold">\n        <select id="nss" class="form-select form-select-sm">\n            <option value="1" selected>Not Started</option>\n            <option value="2">On Track</option>\n            <option value="3">Done</option>\n            </select>\n        </td>\n        <td scope="col"></td>\n        <td scope="col">0</td>\n        <td scope="col-auto">0</td>\n        ${NMC}\n        <td scope="col">\n    \n        </td>\n    </tr>\n    `,$("#Sprintstory").append(NewBlankStory),$("#spbgtable").append(addnewstorybtn),addnewstorybtn.children().children().attr("colspan",10+parseInt(MembersCount))})),$("#sprintbacklogtablearea").on("click","#CancelNewStory",(function(){$("#nsheader").remove(),$(".newtaskbtnrow").show(),$(this).parent().html(AControls)})),$("#sprintbacklogtablearea").on("click","#ConfirmNewStory",(function(){pid=$("#spbgtable").attr("pid"),sid=$("#spbgtable").attr("sid"),t=$("#nst").text(),g=$("#nsg").text(),p=$("#nsp").val(),st=$("#nss").val(),addNewStory(pid,sid,t,g,p,st),$("#nsheader").remove(),$(".newtaskbtnrow").show(),$(this).parent().html(AControls),setTimeout((()=>{ListStories()}),20)})),$("#Sprintstory").on("click",".tskwdata",(function(){$(this).addClass("noborder"),tid=$(this).parent().attr("tid"),stid=$(this).parent().attr("stid"),spid=$(this).parent().attr("spid"),prid=$(this).parent().attr("pid"),forwhat=$(this).attr("for"),$(this).attr("contenteditable","plaintext-only"),$(this).focus()})),$("#Sprintstory").on("blur",".tskwdata",(function(){tid=$(this).parent().attr("tid"),stid=$(this).parent().attr("stid"),spid=$(this).parent().attr("spid"),prid=$(this).parent().attr("pid"),forwhat=$(this).attr("for"),newval=$(this).text(),editTask(prid,spid,stid,tid,forwhat,newval),ListStories()})),$("#Sprintstory").on("click",".tsksdata",(function(){tid=$(this).parent().attr("tid"),stid=$(this).parent().attr("stid"),spid=$(this).parent().attr("spid"),prid=$(this).parent().attr("pid"),forwhat=$(this).attr("for"),selectionBox=`\n    <select class="newdataselect taskstat form-select form-select-sm" for="tskstatus" stid="${stid}" spid="${spid}" pid="${prid}" tid="${tid}">\n        <option value="1">Not Started</option>\n        <option value="2">On Track</option>\n        <option value="3">Done</option>\n    </select>\n    `,"priority"==forwhat?selectionBox=`\n        <select class="newdataselect taskprio form-select form-select-sm" for="priority" stid="${stid}" spid="${spid}" pid="${prid}" tid="${tid}">\n            <option value="1">Low</option>\n            <option value="2">Normal</option>\n            <option value="3">High</option>\n        </select>`:"assignee_id"==forwhat&&(opslist=ListRespMembers(prid,spid),selectionBox=`\n        <select class="newdataselect taskassignee form-select form-select-sm" for="assignee_id" stid="${stid}" spid="${spid}" pid="${prid}" tid="${tid}">\n        ${opslist}\n        </select>`),$(this).removeClass("tsksdata"),$(this).html(selectionBox),$(".taskstat").val($(this).attr("valcode")),$(".taskprio").val($(this).attr("valcode")),$(".taskassignee").val($(this).attr("memid"))})),$("#Sprintstory").on("mouseleave",".newdataselect",(function(){tid=$(this).attr("tid"),stid=$(this).attr("stid"),spid=$(this).attr("spid"),prid=$(this).attr("pid"),forwhat=$(this).attr("for"),newval=$(this).val(),editTask(prid,spid,stid,tid,forwhat,newval),setTimeout((()=>{ListStories()}),50)})),$("#Sprintstory").on("click",".stwdata",(function(){stid=$(this).parent().attr("stid"),spid=$(this).parent().attr("spid"),prid=$(this).parent().attr("pid"),forwhat=$(this).attr("for"),$(this).addClass("noborder"),$(this).attr("contenteditable","plaintext-only"),$(this).focus()})),$("#Sprintstory").on("blur",".stwdata",(function(){$(this).attr("contenteditable","false"),stid=$(this).parent().attr("stid"),spid=$(this).parent().attr("spid"),prid=$(this).parent().attr("pid"),forwhat=$(this).attr("for"),newval=$(this).text(),editStory(prid,spid,stid,forwhat,newval)})),$("#Sprintstory").on("click",".stsdata",(function(){stid=$(this).parent().attr("stid"),spid=$(this).parent().attr("spid"),prid=$(this).parent().attr("pid"),forwhat=$(this).attr("for"),selectionBox=`\n    <select class="newdataselect stat form-select form-select-sm" for="ststatus" stid="${stid}" spid="${spid}" pid="${prid}">\n        <option value="1">Not Started</option>\n        <option value="2">On Track</option>\n        <option value="3">Done</option>\n    </select>\n    `,"priority"==forwhat&&(selectionBox=`\n        <select class="newdataselect prio form-select form-select-sm" for="priority" stid="${stid}" spid="${spid}" pid="${prid}">\n            <option value="1">Low</option>\n            <option value="2">Normal</option>\n            <option value="3">High</option>\n        </select>`),$(this).removeClass("stsdata"),$(this).html(selectionBox),$(".stat").val($(this).attr("valcode")),$(".prio").val($(this).attr("valcode"))})),$("#Sprintstory").on("mouseleave",".newdataselect",(function(){stid=$(this).attr("stid"),spid=$(this).attr("spid"),prid=$(this).attr("pid"),forwhat=$(this).attr("for"),newval=$(this).val(),editStory(prid,spid,stid,forwhat,newval),setTimeout((()=>{ListStories()}),50)})),$("#Sprintstory").on("click","#CallToDeleteStory",(function(){$("#confirmDelStory").modal("show"),prid=$(this).parent().parent().attr("pid"),spid=$(this).parent().parent().attr("spid"),stid=$(this).parent().parent().attr("stid"),$("#ForceDeleteStory").attr("pid",prid),$("#ForceDeleteStory").attr("sid",spid),$("#ForceDeleteStory").attr("stid",stid)})),$("#ForceDeleteStory").click((function(){prid=$(this).attr("pid"),spid=$(this).attr("sid"),stid=$(this).attr("stid"),DeleteStory(prid,spid,stid),ListStories(),setTimeout((()=>{ListStories(),$("#confirmDelStory").modal("hide"),$("#DelToastbody").text("Story Deleted"),$("#liveToast").toast("show")}),100)})),$("#sprintmodal").on("click","#CallToDeleteSP",(function(){$("#confirmDelSprint").modal("show"),prid=$(this).attr("project-id"),spid=$(this).attr("sprint-id"),$("#ForceDeleteSprint").attr("pid",prid),$("#ForceDeleteSprint").attr("sid",spid)})),$("#ForceDeleteSprint").click((function(){prid=$(this).attr("pid"),spid=$(this).attr("sid"),DeleteSprint(prid,spid),ListStories(),setTimeout((()=>{list_sprints(prid),$("#confirmDelSprint").modal("hide"),$("#sprintmodal").modal("hide"),$("#DelToastbody").text("Sprint Deleted"),$("#liveToast").toast("show")}),100)})),$("#sprintbacklogtablearea").on("blur",".tskEstdata",(function(){stid=$(this).attr("stid"),spid=$(this).attr("spid"),pid=$(this).attr("pid"),updateEst(pid,spid,stid),ListStories()})),$("#sprintbacklogtablearea").on("keyup",".relest",(function(){stid=$(this).attr("stid"),spid=$(this).attr("spid"),pid=$(this).attr("pid"),updateEst(pid,spid,stid),ListStories(pid,spid)})),$(".off-project").on("click",".addofftask",(function(){pid=$(this).parent().parent().attr("pid"),sid=$(this).parent().parent().attr("sid"),uid=$(this).parent().parent().attr("user-id");$.ajax({type:"POST",url:"./API/tasks_off.php",data:{action:"addofftask",pid:pid,sid:sid,resp:uid,title:"New Blank Task",status:3,dur:0},dataType:"json",context:document.body,global:!1,async:!1,success:function(t){return t}}).responseText;loadOffTasks()})),$(".off-project").on("click",".Deleteofftask",(function(){pid=$(this).parent().parent().attr("pid"),sid=$(this).parent().parent().attr("sid"),uid=$(this).parent().parent().attr("user-id"),tid=$(this).parent().parent().attr("task-id");$.ajax({type:"POST",url:"./API/tasks_off.php",data:{action:"deleteofftask",pid:pid,sid:sid,tid:tid,uid:uid},dataType:"json",context:document.body,global:!1,async:!1,success:function(t){return t}}).responseText;loadOffTasks()})),$(".off-project").on("click",".offtask-toggle-data",(function(){3==$(this).attr("init")&&"Done"==$(this).text()?(pid=$(this).parent().attr("pid"),sid=$(this).parent().attr("sid"),uid=$(this).parent().attr("user-id"),tid=$(this).parent().attr("task-id"),forwhat=$(this).attr("for"),offtaskUpdate(pid,sid,tid,uid,forwhat,1)):1==$(this).attr("init")&&"Not Started"==$(this).text()?(pid=$(this).parent().attr("pid"),sid=$(this).parent().attr("sid"),uid=$(this).parent().attr("user-id"),tid=$(this).parent().attr("task-id"),forwhat=$(this).attr("for"),offtaskUpdate(pid,sid,tid,uid,forwhat,3)):loadOffTasks()})),$(".off-project").on("click",".offtask-data",(function(){$(this).attr("contenteditable","plaintext-only"),$(this).addClass("noborder"),$(this).focus()})),$(".off-project").on("blur",".offtask-data",(function(){$(this).attr("contenteditable","false"),pid=$(this).parent().attr("pid"),sid=$(this).parent().attr("sid"),uid=$(this).parent().attr("user-id"),tid=$(this).parent().attr("task-id"),forwhat=$(this).attr("for"),offtaskUpdate(pid,sid,tid,uid,forwhat,$(this).text()),loadOffTasks()}));